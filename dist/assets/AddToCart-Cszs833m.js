import{u as f,s as T,v as O,r as d,_ as R,a as i,j as t,M as E,L as b,t as a}from"./vendor-DZSY-1uI.js";import{u as B,R as D,C as F}from"./index-B9WYzanr.js";const q=()=>{const{address:h}=B(),o=f(e=>e.AccRefToken.AccRefToken.accessToken),c=f(e=>e.addtocart.items),p=T(),j=O(),[x,v]=d.useState(""),[N,w]=d.useState(0),[m,l]=d.useState({});d.useEffect(()=>{const e={};c.forEach(s=>{e[s._id]=1}),l(e)},[c]);const g=d.useCallback(R.debounce(async(e,s)=>{if(o)try{await i.post("http://localhost:8000/api/v1/users/AddToCart",{quantity:s,productId:e},{headers:{Authorization:`Bearer ${o}`}})}catch(r){console.log("Something went wrong",r)}},500),[o]),C=e=>{l(s=>{const r={...s,[e]:(s[e]||1)+1};return g(e,r[e]),r})},_=e=>{l(s=>{const r={...s,[e]:Math.max((s[e]||1)-1,1)};return g(e,r[e]),r})},k=async e=>{try{const s=await i.post("http://localhost:8000/api/v1/users/RemoveFromCart",{productId:e},{headers:{Authorization:`Bearer ${o}`}});s.data.statusCode===200&&a.success(s.data.message),p(D({_id:e})),l(r=>{const n={...r};return delete n[e],n})}catch(s){console.log("Something went wrong while removing the item",s)}},A=e=>v(e.target.value),P=async e=>{e.preventDefault();try{const r=(await i.get("http://localhost:8000/api/v1/Admin/promoCodes")).data.data.find(n=>n.code===x);r?(w(r.discount),a.success("Promo code applied")):a.error("Please enter a valid promo code")}catch(s){console.error("Error fetching promo codes:",s)}},y=()=>{let e=0;return c.forEach(s=>{const r=m[s._id]||1;e+=s.Price*r}),e-e*N/100},z=async()=>{if(!h){a.error("Please enter your address");return}try{const e=c.map(r=>({productId:r._id,quantity:m[r._id]||1,ProductName:r.ProductName,ProductImg:r.images,address:h})),s=await i.post("http://localhost:8000/api/v1/order/placeOrder",{items:e,amount:y()},{headers:{Authorization:`Bearer ${o}`}});if(console.log(s),s.data.statusCode===200){a.success("Order placed successfully"),console.log(s);const{razorpayOrderId:r,amount:n,newOrder:I}=s.data.data,S={key:"rzp_test_vdBH4tnXPZUuKr",amount:n*100,currency:"INR",name:"Your Company Name",description:"Test Transaction",order_id:r,handler:async function(u){await i.post("http://localhost:8000/api/v1/order/verify-payment",{Payment_Id:u.razorpay_payment_id,Order_Id:u.razorpay_order_id,Signature:u.razorpay_signature,newOrder:I},{headers:{Authorization:`Bearer ${o}`}}),console.log("OKIe",u.razorpay_signature),p(F()),j("/OrderConfirmation")},theme:{color:"#3399cc"}};new window.Razorpay(S).open()}else a.error(s.data.message)}catch(e){console.error("Error placing order:",e),a.error("Something went wrong while placing the order")}};return t.jsx("section",{className:"bg-gray-100 py-12",children:t.jsx("div",{className:"container mx-auto px-4 lg:px-8",children:t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[t.jsx("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:t.jsxs("div",{className:"px-6 py-4",children:[t.jsx("h2",{className:"text-3xl font-semibold text-gray-800 mb-4",children:"Shopping Cart"}),t.jsx("hr",{}),c.map(e=>t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 py-4 hover:bg-gray-50 transition duration-300 ease-in-out",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("img",{src:e.images,alt:e.ProductName,className:"w-16 h-16 object-cover rounded-lg"}),t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:e.ProductName}),t.jsx("p",{className:"text-sm text-gray-500",children:e._id})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{className:"text-lg text-gray-500 focus:outline-none",onClick:()=>_(e._id),children:"-"}),t.jsx("span",{className:"text-lg font-semibold",children:m[e._id]||1}),t.jsx("button",{className:"text-lg text-gray-500 focus:outline-none",onClick:()=>C(e._id),children:"+"})]}),t.jsx("button",{className:"text-red-500 hover:text-red-700 transition duration-200",onClick:()=>k(e._id),children:t.jsx(E,{size:24})})]})]},e._id)),t.jsxs("div",{className:"flex justify-between items-center mt-4",children:[t.jsx("h3",{className:"text-xl font-semibold text-gray-800",children:"Total:"}),t.jsxs("p",{className:"text-xl font-semibold text-gray-800",children:["â‚¹",y().toFixed(2)]})]}),t.jsxs("form",{onSubmit:P,className:"mt-6 flex items-center",children:[t.jsx("input",{type:"text",value:x,onChange:A,placeholder:"Enter promo code",className:"border border-gray-300 rounded-lg px-4 py-2 w-full"}),t.jsx("button",{type:"submit",className:"ml-4 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200",children:"Apply"})]})]})}),t.jsx("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden",children:t.jsxs("div",{className:"px-6 py-4",children:[t.jsx("h2",{className:"text-3xl font-semibold text-gray-800 mb-4",children:"Checkout"}),t.jsx("hr",{}),h?t.jsx("button",{onClick:z,className:"block bg-red-600 text-white text-center rounded-lg py-2 mt-6 hover:bg-red-700 transition duration-200",children:"Place Order"}):t.jsx(b,{to:"/AddressForm",className:"block bg-red-600 text-white text-center rounded-lg py-2 mt-6 hover:bg-red-700 transition duration-200",children:"Add Address"}),t.jsx(b,{to:"/",className:"block bg-gray-200 text-gray-800 text-center rounded-lg py-2 mt-4 hover:bg-gray-300 transition duration-200",children:"Continue Shopping"})]})})]})})})};export{q as default};
